version: "3.2"

services:
  audiolizer:
    image: apembroke/audiolizer:latest
    ports:
      - "80:5000"
    environment:
      AUDIOLIZER_TEMP: /home/audiolizer/audiolizer/history
    command: ["gunicorn", "--bind", "0.0.0.0:5000", "audiolizer:server"]
    volumes:
      - type: bind
        source: ${AUDIOLIZER_ASSETS}
        target: /home/audiolizer/audiolizer/assets
      - type: bind
        source: ${AUDIOLIZER_PRICES}
        target: /home/audiolizer/audiolizer/history
    working_dir: /home/audiolizer/audiolizer
#dev config
  audiolizer-dev:
    image: apembroke/audiolizer:latest
    ports:
      - "80:8051"
      - "8888:8888"
    environment:
      AUDIOLIZER_TEMP: /home/audiolizer/audiolizer/history
    command: ["python", "audiolizer.py"]
    # command: ["jupyter", "notebook", "audiolizer.py", "--port=8888", "--no-browser", "--ip=0.0.0.0", "--allow-root"]
    volumes:
      - type: bind
        source: ${AUDIOLIZER_ASSETS}
        target: /home/audiolizer/audiolizer/assets
      - type: bind
        source: ${AUDIOLIZER_PRICES}
        target: /home/audiolizer/audiolizer/history
      - type: bind
        source: ${AUDIOLIZER_SRC}
        target: /home/audiolizer
    working_dir: /home/audiolizer/audiolizer

        