version: "3.7"

services:
  # redis:
  #   image: "redis:alpine"
  #   ports:
  #     - "6379:6379"

  audiolizer:
    image: apembroke/audiolizer:0.4.11
    build: .
    ports:
      - "8080:8080"
    environment:
      AUDIOLIZER_TEMP: /home/audiolizer/audiolizer/history
      PYTHONUNBUFFERED: 1
    command: ["gunicorn", "--workers=1", "--bind", "0.0.0.0:8080", "audiolizer:server"]
    volumes:
      - type: bind
        source: ${PWD}
        target: /home/audiolizer
    working_dir: /home/audiolizer/audiolizer

  audiolizer-dev:
    image: apembroke/audiolizer:0.4.11
    ports:
      - "8050:8050"
      - "8888:8888"
    environment:
      AUDIOLIZER_TEMP: /home/audiolizer/audiolizer/history
    command: ["python", "audiolizer.py"] # runs on port 8051
    # command: ["jupyter", "notebook", "audiolizer.py", "--port=8888", "--no-browser", "--ip=0.0.0.0", "--allow-root"]
    volumes:
      - type: bind
        source: ${PWD}
        target: /home/audiolizer
    working_dir: /home/audiolizer/audiolizer
